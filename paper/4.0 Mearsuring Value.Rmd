---
output:
  pdf_document: default
  html_document: default
editor_options: 
  markdown: 
    wrap: 80
---

# Measuring Value

We now consider the two primary sources of value for the insured:

-   The ability to deploy capital that it would have otherwise had to set aside
    for an insurable event.

-   Reduced volatility of earnings and the resulting reduction in required
    return.

We review the first source of value creation in Section X.1 and the second
source in Section X.2.

In our review, we assume the following:

-   There is a fixed amount of capital, $C$, available to the firm.

-   The firm requires minimum capital, $C_m$, to continue as a going concern.

-   We denote deployed capital, i.e., the working capital, as $C_w$.

-   The firm is subject to the loss events that result in aggregate claim
    amounts, $X$. We present distribution of claim amounts in FigureÂ X[^1].

    -   For simplicity, we assume information symmetry as respects $X$. That is,
        the insurer and the insured use the same distribution for $X$.

    -   We denote the maximum probable claim amount as $X_m$.

    -   The scale of $X$ is a function of $C_w$.

    ```{r Claim Distribution, echo=FALSE, fig.height=3, fig.width=5, message=FALSE, paged.print=FALSE, fig.cap="Claim (X) Distribution"}
    par(mar = c(2, 2, 1, 1))
    rate <- 6
    dens <- 100
    d_x <- seq(from = 0, to = rate, length.out = dens)
    d_y <- dexp(1:dens / dens, rate = rate) / rate

    plot(x = d_x, y = d_y,  type = 'l', col = 'blue', lty = 'dotted', axes = FALSE,
      xlab = '', ylab = '')
    box()
    mtext(text = expression(italic(X)), side = 1, line = 0.5, cex = 0.7)
    mtext(text = 'Density', side = 2, line = 0.5, cex = 0.7)
    ```

-   The firm has an enterprise risk management (ERM)
    strategy underlying its capital allocation. Its ERM strategy dictates that
    it can
    absorb a claim at the $p^{th}$ percentile of the distribution of $X$ which
    we denote as $X_p$.

-   The firm is able to generates a return on capital of $r_c$.

-   We denote the risk free rate $r_f$.

[^1]: This is an illustrative claim distribution that we present to support
    further development of value measurement.

## Capital Deployment

In order to measure of the value of insurance related to the firm's ability to
deploy capital, we compare rates of return both with and without insurance.

### Rate of Return without Insurance

The firm's ERM strategy will require that it set aside a reserve in case it was
to experience a capital depletion event that reduces. We denote this reserve as
$C_x$, to indicate that the reserve is a seggregation of capital to absorb
realizations of $X$ that reduce $C$ below $C_m$. We present that capital
allocation approach in Figure X.

```{r No Insurnace, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
par(mar = c(1, 1, 1, 1))

scale <- 10

center <- 1
plot(x = 1, y = 1, type = 'n', xlim = c(0.9, 1.9),
  bty = 'n', axes = FALSE, ylim = c(0, 1.2 * scale), ylab = '', xlab = '')
rect(xleft = center - 0.1, ybottom = 0, xright = center + 0.1, ytop = scale)
#text(x = center, y = 3, label = 'Working Capital', cex = 0.7)
text(x = center, y = 1.05 * scale, label = 'Available Capital', cex = 0.7)

# Minimum working capital -----
c_m <- 0.6 * scale
text(x = center, y = c_m, label = 'Minimum Working Capital', col = 'red' , 
  pos = 3, cex = 0.7, adj = 0)
abline(h = c_m, col = 'red', lty = 'dashed')


# Plot loss RV rotate ----
center <- 1.25

dens <- 100
dens_width <- 0.2
dens_left <- center - dens_width / 2

rate <- 9.430859 #Start at rate <- scale and iterate (see base_case.R)
d_x <- seq(from = rate, to = 0, length.out = dens)
rate <- scale - (c_m - d_x[43])

d_x <- seq(from = rate, to = 0, length.out = dens)
d_y <- dexp(1:dens / dens, rate = rate) / rate * dens_width + dens_left

points(y = d_x, x = d_y,  type = 'l', col = 'blue', lty = 'dotted')

text(x = center, y = d_x[43], label = 'ERM Threshold', col = 'blue' , 
  pos = 1, cex = 0.7, lty = 'dashed')

text(x = dens_left, y = .90 * rate, pos = 2, label = expression(italic(X)), srt = 270, col = 'blue', cex = 0.7, adj = c(0, 0))

text(x = dens_left, y = d_x[43], pos = 1, label = expression(X[`p`]), srt = 270, col = 'blue', cex = 0.7, adj = c(0, 0))


abline(h = d_x[43], col = 'blue', lty = 'dotted')

rect(xleft = dens_left, xright = dens_left + dens_width, ybottom = 0, 
  ytop = rate, border = 'blue', lty = 'dotted')

text(x = dens_left + dens_width / 2, y = rate, 
  label = 'Claim (X) Distribution', cex = 0.7, col = 'blue', pos = 3)


# reserve -----
center <- 1.50
res_left <- 1.50 - .1
rect(ybottom = d_x[43], ytop = c_m, xleft = res_left, xright = res_left + 
    dens_width, col = 'grey90', lty = 'dotted')

text(x = mean(c(res_left, res_left + dens_width)), y = mean(c(d_x[43], c_m)), 
  label = 'Reserves\n(Segregated Capital)', cex = 0.7)

arrow_bend_y <- mean(c(scale, scale - (c_m - d_x[43])))

lines(x = rep(
  mean(c(res_left, res_left + dens_width)), 
  times = 2), 
  y = c(c_m, arrow_bend_y), lty = 'dotted')

arrows(x0 = center, y0 = arrow_bend_y, 
  x1 = center + 0.15, lty = 'dotted')

# Allocated Capital ----

center <- 1.75

rect(xleft = center - 0.1, ybottom = 0, xright = center + 0.1, 
  ytop = scale - (c_m - d_x[43]), border = 'red')

rect(xleft = center - 0.1, ybottom = scale - (c_m - d_x[43]), 
  xright = center + 0.1, ytop = scale , col = 'grey90', lty = 'dotted')

text(x = center, y = mean(
  c(scale, 
    scale - (c_m - d_x[43])
  )), 
  label = expression(italic(CX)[`0`]), cex = 0.7)

text(x = center, y = 5, label = expression(italic(CW)[`0`]), cex = 0.7, col = 'red')

text(x = center, y = 1.05 * scale, label = 'Available Capital', cex = 0.7)

#'Working Capital'
```

Using the naught subscript to represent this base case, the rate of return is
then as follows:

$$
R_{0} = \dfrac{r_c \times CW_{0} + r_f \times CX_{0} - X}{C}
$$

The numerator is the sum of the return on working capital, the return on the
reserve less the value of the claim amount. The inclusion of the random variable
$X$ indicates that the return is a function of the realized value of the loss
event.

### Rate of Return with Insurance

If instead, the firm purchases insurance to cover a portion of loss event for a
certain premium, using the subscript, $I$, to represent the "insurance case,"
then the rate of return is as follows:

$$
R_{I} = \dfrac{r_c \times (CW_{I} - P) + r_f \times CX_{I} - X_{ret} - P}{C}
$$

where $X_{ret}$ represents portion of the distribution of claims values that the
firm retains. We express $X_{ret}$ using the convention used to specify
insurance policies. That convention specifies the layer as the limit of the
insurance payment, $L$, in excess of the attachment point, $AP$ of the coverage.
We allow $X_{ret}$ (i.e. to $L$) vary between 0 (equal to the no insurance case)
and $X_m$ (in which case, the firm fully transfers the risk). We observe that
for $0 < X_{ret} < (X_p - C_m)$, $C_x = 0$.

$P$ is the sum of the expected loss $E[X - X_{ret}]$ and an insurance charge.
The insurance charge contemplates the insurer for underwriting the exposure and
provides for a return on its capital. Therefore we expect the insurance charge
to be a function of $Var(X - X_{ret})$. However, the firm only observes premiums
quoted under various options. As such, it is not concerned with the function the
insurer uses to develop its risk charge.

### Value Creation

We observe that the purchase insurance creates value when: $$
\begin{aligned}
R_I &> R_0 \\
r_c \times (C-P-CX_{I}) + r_f \times CX_{I} - X_{ret} - P &> r_c \times CW_{0} + r_f \times CX_{0} - X \\
P + X_{ret} &< r_c \times (C - P - CX_I - CW_{0}) + r_f \times (CX_{I} - CX_{0}) + X \\
P  &< r_c \times (C - P - CX_I - CW_{0}) + r_f \times (CX_{I} - CX_{0}) + X - X_{ret}
\end{aligned}
$$

To simplify this equation:

-   For the rational firm (where $r_c > r_f$[^2]) purchases insurance such that
    it need not set aside any capital. Therefore, $CX_I = 0$ and $CW_I = C - P$.

-   We note that the expected value of $X$ in high excess layers is nearly 0.
    That is, $E[X] \approx 0$ and $E[X_{ret}] \approx 0$. Moreover,
    $E[X - X_{ret}] \approx 0$. As a result, taking expectations, our value
    equation reduces to:

[^2]: Without this condition there is no economic value to the firm's existence.

$$
\begin{aligned}
P &< r_c \times (C - P - CW_0) + r_f \times (-CX_0)\\
P &< r_c \times (-P) + r_c \times CX_0 + r_f \times (-CX_0)\\
P \times (1 + r_c) &< CX_0 \times (r_c - r_f)\\
P &< CX_0 \times \dfrac{(r_c - r_f)}{(1 + r_c)}
\end{aligned}
$$

The equation has a straightforward intuitive interpretation that the insurance
transaction creates value when the premium is less than the excess return on
capital that would be earned on the reserve reduced for the return on capital if
the premium amount were also deployed as capital.



## Risk Premium Rate
### Approach 1: Penalty function on Rate of Return ($R_0$ and $R_1$),
### I write 2 possible Approaches to apply the penalty function, we can pick a better one

### Without insurance
I only assume X and $r_c$ are random variables\

$r_c$ follows a lognormal distribution or any other reasonable distributions\


About X, I first define a variable $X_{original}$ with $E(X_{original}) \approx 0$, and $var(X_{original}) \neq 0$\
$$
X =
\begin{cases}
X_{original}& {X_{original}<= CX_0}\\
X_{original}+(1+F_{penalty}) \times (X_{original}-CX_0) & {X_{original}>CX_0}\\
\end{cases}
$$
Then, we can calculate  $E(r_0)$, $var(r_0)$



$$
\begin{aligned}
E(R_{0}) &= E(\dfrac{r_c \times CW_{0} + r_f \times CX_{0} - X}{C})\\
&=\frac{CW_{0}\times E(r_c)}{C} -\frac{E(X)}{C} +\frac{r_f \times CX_{0}}{C}\\
&=\frac{CW_{0}\times E(r_c)}{C} +\frac{r_f \times CX_{0}}{C}\\
&=\frac{(C-CX_{0})\times E(r_c)}{C} +\frac{r_f \times CX_{0}}{C}\\
\\
var(R_{0}) &= var(\dfrac{r_c \times CW_{0} + r_f \times CX_{0} - X}{C})\\
&=\frac{CW_{0}^2\times var(r_c)}{C^2} +\frac{var(X)}{C^2}-\frac{2 \times CW_{0} \times cov(X,r_c)}{C^2} \\
&=\frac{(C-CX_{0})^2\times var(r_c)}{C^2} +\frac{var(X)}{C^2}
\end{aligned}
$$

Then, we can use Sharpe Ratio ($\frac{E(\ R)-r_f}{\sigma_{R}}$), which shows every unit of volatility would bring how much of the risk premium rate of return. we can calculate the optimal reserve amount($CX_0$) using Sharpe Ratio as criterion at this step.\
The higher the Sharpe Ratio, the better the investment is.

$$
\begin{aligned}
Sharpe\ Ratio 
&=\frac{E(\ R_0)-r_f}{\sigma_{R_0}}\\
&=\frac{(C-CX_{0})\times E(r_c)+r_f \times CX_{0}-r_f *C}{C} / (\frac{(C-CX_{0})^2\times var(r_c)+var(x)}{C^2})^{0.5}\\
&=\frac{(C-CX_{0})\times (E(r_c)-r_f)}{((C-CX_{0})^2\times var(r_c)+var(x))^{0.5}}\\
\end{aligned}
$$

### With Insurance


Then we calculate $E(r_I)$, $var(r_I)$
$$
\begin{aligned}
E(R_{I}) &= E(\dfrac{r_c \times (CW_{I} - P) + r_f \times CX_{I} - X_{ret} - P}{C})\\
&=\frac{(CW_{I} - P)\times E(r_c)}{C} -\frac{E(X_{ret})}{C} +\frac{r_f \times CX_{I}-P}{C}\\
&=\frac{(CW_{I} - P)\times E(r_c))}{C} +\frac{r_f \times CX_{I}-P}{C}\\
&=\frac{(C - P)\times E(r_c))-P}{C}\\
\\
var(R_{I}) &= var(\dfrac{r_c \times (CW_{I} - P) + r_f \times CX_{I} - X_{ret} - P}{C})\\
&=\frac{(CW_{I} - P)^2\times var(r_c)}{C^2} +\frac{var(X_{ret})}{C^2}-\frac{2 \times (CW_{I} - P) \times cov(X_{ret},r_c)}{C^2} \\
&=\frac{(C - P)^2\times var(r_c)}{C^2} +\frac{var(X_{ret})}{C^2}
\end{aligned}
$$
Then We can calculate the Sharpe Ratio under the with Insurance case

$$
\begin{aligned}
Sharpe\ Ratio&=
\frac{E(\ R_I)-r_f}{\sigma_{R_0}}\\
&=\frac{(C - P)\times E(r_c))-P-C \times rf}{C}\ / (\frac{(C-P)^2\times var(r_c)+var(X_{ret})}{C^2})^{0.5}\\
&=\frac{C\times (E(r_c)-r_f)-P \times(1+E(r_c))}{((C-P)^2\times var(r_c)+var(X_{ret}))^{0.5}}\\
\end{aligned}
$$
Finally, we can simplify and compare these 2 Sharpe Ratio.
I haven't gone through strict calculation yet, but  via simple comparison,
we can find that with the increase of var(x), the 'with insurance' Sharpe Ratio  will decrease more slowly than 'without insurance',
which shows the value of insurance. 

P.S. When we compare the expected returns of 2 cases, the result would be exactly the same as the result in Value Creation Section. So I didn't attach it one more time.



### Approach 2: Penalty function on Rate of Capital ($R_c$), unfinished
### This approach would be more difficult in calculation 
### Without insurance
I only assume X and $r_c$ are random variables\
About X, I assume a distribution with $E(X) \approx 0$, and $var(X) \neq 0$\
Then, we assume $r_c$ follows a conditional lognormal distribution based on X


$$
r_c|X \backsim 
\begin{cases}
lognormal(\mu_0,\sigma_0)& {X<= CX_0}\\
lognormal(\mu_0 (1-\frac{X-CX_{0}}{CW_{0}}),\sigma_0/(1-\frac{X-CX_{0}}{CW_{0}}))& {X>CX_0}\\
\end{cases}
$$
Then, we can calculate $E(r_c)$, $var(r_c)$, then the $E(r_0)$, $var(r_0)$

$$
\begin{aligned}
E(r_c)&=E(E(r_c|X))\\
\\
var(r_c)&=E(var(r_c|X))+var(E(r_c|X))\\
\\
E(R_{0}) &= E(\dfrac{r_c \times CW_{0} + r_f \times CX_{0} - X}{C})\\
&=\frac{CW_{0}\times E(r_c)}{C} -\frac{E(X)}{C} +\frac{r_f \times CX_{0}}{C}\\
&=\frac{CW_{0}\times E(E(r_c|X))}{C} -\frac{E(X)}{C} +\frac{r_f \times CX_{0}}{C}\\
&=\frac{CW_{0}\times E(E(r_c|X))}{C} +\frac{r_f \times CX_{0}}{C}\\
\\
var(R_{0}) &= var(\dfrac{r_c \times CW_{0} + r_f \times CX_{0} - X}{C})\\
&=\frac{CW_{0}^2\times var(r_c)}{C^2} +\frac{var(X)}{C^2}-\frac{2 \times CW_{0} \times cov(X,r_c)}{C^2} \\
&=\frac{CW_{0}^2\times (E(var(r_c|X))+var(E(r_c|X)))}{C^2} +\frac{var(X)}{C^2} -\frac{2 \times CW_{0} \times (E(r_c \times X)-E(E(r_c|X))\times E(X) )}{C^2}\\
&=\frac{CW_{0}^2\times (E(var(r_c|X))+var(E(r_c|X)))}{C^2} +\frac{var(X)}{C^2} -\frac{2 \times CW_{0} \times (E(r_c \times X))}{C^2}
\end{aligned}
$$

### With Insurance

$$
r_c|X_{ret} \backsim 
\begin{cases}
lognormal(\mu_0,\sigma_0)& {X_{ret}<= CX_I }\\
lognormal(\mu_0 (1-\frac{X-CX_{0}}{CW_{0}}),\sigma_0/(1-\frac{X-CX_{0}}{CW_{0}}))& {X_{ret}> CX_I }\\
\end{cases}
$$

Then we calculate $E(r_I)$, $var(r_I)$
$$
\begin{aligned}
E(R_{I}) &= E(\dfrac{r_c \times (CW_{I} - P) + r_f \times CX_{I} - X_{ret} - P}{C})\\
&=\frac{(CW_{I} - P)\times E(r_c)}{C} -\frac{E(X_{ret})}{C} +\frac{r_f \times CX_{I}-P}{C}\\
&=\frac{(CW_{I} - P)\times E(E(r_c|X_{ret}))}{C} -\frac{E(X_{ret})}{C} +\frac{r_f \times CX_{I}-P}{C}\\
&=\frac{(CW_{I} - P)\times E(E(r_c|X_{ret}))}{C} +\frac{r_f \times CX_{I}-P}{C}\\
\\
var(R_{I}) &= var(\dfrac{r_c \times (CW_{I} - P) + r_f \times CX_{I} - X_{ret} - P}{C})\\
&=\frac{(CW_{I} - P)^2\times var(r_c)}{C^2} +\frac{var(X_{ret})}{C^2}-\frac{2 \times (CW_{I} - P) \times cov(X_{ret},r_c)}{C^2} \\
&=\frac{(CW_{I} - P)^2\times (E(var(r_c|X_{ret}))+var(E(r_c|X_{ret})))}{C^2} +\frac{var(X_{ret})}{C^2} -\frac{2 \times (CW_{I} - P) \times (E(r_c \times X_{ret})-E(E(r_c|X_{ret}))\times E(X_{ret}) )}{C^2}\\
&=\frac{(CW_{I} - P)^2\times (E(var(r_c|X_{ret}))+var(E(r_c|X_{ret})))}{C^2} +\frac{var(X_{ret})}{C^2} -\frac{2 \times (CW_{I} - P) \times (E(r_c \times X_{ret})}{C^2}
\end{aligned}
$$